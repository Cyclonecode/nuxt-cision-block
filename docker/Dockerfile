FROM node:16.13-slim

WORKDIR /usr/src/app
COPY ./docker .
RUN npm i --only=production
RUN mkdir ./node_modules/nuxt-cision-block
COPY ./lib ./node_modules/nuxt-cision-block/lib
COPY ./package*.json ./node_modules/nuxt-cision-block/
RUN npm run build

ARG PORT
ARG BASE_PATH
ARG FEED_ID
ARG USE_CAHCE
ARG CACHE_MAX
ARG CACHE_MAX_AGE
ARG SHOW_IMAGE
ARG SHOW_INTRO
ARG SHOW_BODY
ARG SHOW_ARTICLE_IMAGE
ARG SHOW_ARTICLE_INTRO
ARG SHOW_ARTICLE_BODY
ARG SHOW_ARTICLE_FILES
ARG DISPLAY_MODE
ARG ITEMS_PER_PAGE
ARG ITEM_COUNT
ARG MUST_HAVE_IMAGE
ARG START_DATE
ARG END_DATE
ARG LANGUAGE
ARG CATEGORIES
ARG KEYWORDS
ARG MARK_ITEM
ARG REGULATORY_TEXT
ARG NON_REGULATORY_TEXT

ENV NUXT_HOST=0.0.0.0 \
    NUXT_PORT=$PORT \
    BASE_PATH=$BASE_PATH \
    FEED_ID=$ID \
    SHOW_IMAGE=$SHOWIMAGE \
    SHOW_INTRO=$SHOW_INTRO \
    SHOW_BODY=$SHOW_BODY \
    SHOW_ARTICLE_IMAGE=$SHOW_ARTICLE_IMAGE \
    SHOW_ARTICLE_INTRO=$SHOW_ARTICLE_INTRO \
    SHOW_ARTICLE_BODY=$SHOW_ARTICLE_BODY \
    SHOW_ARTICLE_FILES=$SHOW_ARTICLE_FILES \
    DISPLAY_MODE=$DISPLAY_MODE \
    ITEMS_PER_PAGE=$ITEMS_PER_PAGE \
    ITEM_COUNT=$ITEM_COUNT \
    MUST_HAVE_IMAGE=$MUST_HAVE_IMAGE \
    START_DATE=$START_DATE \
    END_DATE=$END_DATE \
    LANGUAGE=$LANGUAGE \
    CATEGORIES=$CATEGORIES \
    KEYWORDS=$KEYWORDS \
    MARK_ITEM=$MARK_ITEM \
    REGULATORY_TEXT=$REGULATORY_TEXT \
    NON_REGULATORY_TEXT=$NON_REGULATORY_TEXT

EXPOSE $NUXT_PORT

CMD ["npm", "run", "start"]
